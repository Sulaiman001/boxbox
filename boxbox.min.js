/* Copyright 2013 Christophe Rosset. Licensed under the MIT License. http://topheman.github.com/boxbox/ */
/* Copyright 2012 Greg Smith. Licensed under the MIT License. http://incompl.github.com/boxbox/ */
(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),function(){function t(e){function t(){}return t.prototype=e,new t}function n(e,t){var r,i,s;e===undefined&&(e={});if(t!==undefined)for(i in t)if(t.hasOwnProperty(i)&&e[i]===undefined)if(Object.prototype.toString.call(t[i])==="[object Array]"){e[i]=[];for(s=0;s<t[i].length;s++)e[i].push(t[i][s])}else typeof t[i]=="object"&&t[i]!==null&&t[i]!==undefined?e[i]=n(e[i],t[i]):e[i]=t[i];return e}var e=57.2957795;window.boxbox={};if(Box2D===undefined){console.error("boxbox needs Box2d to work");return}var r=Box2D.Common.Math.b2Vec2,i=Box2D.Common.Math.b2Math,s=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2Body,u=Box2D.Dynamics.b2FixtureDef,a=Box2D.Dynamics.b2Fixture,f=Box2D.Dynamics.b2World,l=Box2D.Collision.Shapes,c=Box2D.Dynamics.b2DebugDraw,h=Box2D.Collision.b2AABB;window.boxbox.createWorld=function(e,n){var r=t(m);return r._init(e,n),r};var p={gravity:{x:0,y:10},allowSleep:!0,scale:30,tickFrequency:50,collisionOutlines:!1,disableTouchEvents:!1,disableMouseEvents:!1,disableKeyEvents:!1,preventScroll:!1,_mousePan:{disabled:!0,excludeEntityIds:[],multiplier:1},_touchPan:{disabled:!0,multiplier:1,excludeEntityIds:[],allowPinch:{}}},d={type:"distance",allowCollisions:!1},v="world",m={_ops:null,_world:null,_canvas:null,_keydownHandlers:{},_keyupHandlers:{},_mousedownHandlers:{},_mouseupHandlers:{},_mousemoveHandlers:{},_mouseinHandlers:{},_mouseoutHandlers:{},_mouseStartdragHandlers:{},_mouseDragHandlers:{},_mouseStopdragHandlers:{},_mousePanStartdragHandler:null,_mousePanDragHandler:null,_mousePanStopdragHandler:null,_touchstartHandlers:{},_touchendHandlers:{},_touchmoveHandlers:{},_touchStartdragHandlers:{},_touchDragHandlers:{},_touchStopdragHandlers:{},_touchAddtouchdragHandlers:{},_touchRemovetouchdragHandlers:{},_touchPanStartDragHandler:null,_touchPanDragHandler:null,_touchPanStopDragHandler:null,_startContactHandlers:{},_finishContactHandlers:{},_impactHandlers:{},_destroyQueue:[],_impulseQueue:[],_constantVelocities:{},_constantForces:{},_entities:{},_nextEntityId:0,_cameraX:0,_cameraY:0,_onRender:[],_onTick:[],_creationQueue:[],_positionQueue:[],_pause:!1,_mouseHoverEntityId:null,_mouseDraggingEntityId:null,_touchDraggingEntityIds:[],_mouseDraggableEntityIds:[],_touchDraggableEntityIds:[],_init:function(e,t){var i=this,s,o,u,a;this._ops=n(t,p),this.checkListenersOptions(),this._world=new f(new r(this._ops.gravity.x,this._ops.gravity.y),!0),u=this._world,this._canvas=e,this._ctx=this._canvas.getContext("2d"),this._scale=this._ops.scale,this.viewport=function(e){return{_world:e,getCurrentWindowInfos:function(){var e,t=this._world.camera(),n=this._world.scale();return e={x:t.x,y:t.y,width:this._world._canvas.width/n,height:this._world._canvas.height/n,scale:n},e},getMaxWindowInfos:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=[],N=[],C,k,L,A,O,M=this._world.scale();for(s in this._world._entities){o=this._world._entities[s].position(),a=this._world._entities[s]._body.GetAngle();if(this._world._entities[s]._ops.shape==="circle")u=this._world._entities[s]._ops.radius,T.push(o.x+u),T.push(o.x-u),N.push(o.y+u),N.push(o.y-u);else if(this._world._entities[s]._ops.shape==="square")f=this._world._entities[s]._ops.width/2,l=this._world._entities[s]._ops.height/2,p=o.x,d=o.y,c=-(f*Math.cos(a)-l*Math.sin(a))+p,h=-(f*Math.sin(a)+l*Math.cos(a))+d,T.push(c),N.push(h),c=-(f*Math.cos(a)+l*Math.sin(a))+p,h=-(f*Math.sin(a)-l*Math.cos(a))+d,T.push(c),N.push(h),c=f*Math.cos(a)-l*Math.sin(a)+p,h=f*Math.sin(a)+l*Math.cos(a)+d,T.push(c),N.push(h),c=f*Math.cos(a)+l*Math.sin(a)+p,h=f*Math.sin(a)-l*Math.cos(a)+d,T.push(c),N.push(h);else{v=this._world._entities[s]._body,m=v.GetFixtureList().GetShape().GetVertices(),g={};for(y=0;y<m.length;y++)g[y]=v.GetWorldPoint(m[y]),T.push(g[y].x),N.push(g[y].y)}}return T.sort(function(e,t){return e-t}),N.sort(function(e,t){return e-t}),C=T[0],k=T[T.length-1],L=N[0],A=N[N.length-1],O={x:C,y:L,width:k-C,height:A-L,scale:M},e&&(b=this.getCurrentWindowInfos(),w=O.height,E=O.width,S=this._world._canvas.width/this._world._canvas.height,x=O.width/O.height,O.scale=x>=1?this._world._canvas.width/O.width:this._world._canvas.height/O.height,S>=1?O.height=O.width*b.height/b.width:O.width=O.height*b.width/b.height,x>=1?O.y=O.y-(this._world._canvas.height/O.scale-w)/2:O.x=O.x-(this._world._canvas.width/O.scale-E)/2),O},focusAll:function(){var e=this.getMaxWindowInfos(!0);return this._world.camera({x:e.x,y:e.y}),this._world.scale(e.scale),e}}}(this);if(this._canvas!==undefined){if(this._ops.debugDraw){var l=new c;l.SetSprite(this._canvas.getContext("2d")),l.SetDrawScale(this._scale),l.SetFillAlpha(.3),l.SetLineThickness(1),l.SetFlags(c.e_shapeBit|c.e_jointBit),u.SetDebugDraw(l)}window.setInterval(function(){var e,t;for(e=0;e<i._onTick.length;e++)t=i._onTick[e].ctx,t._destroyed||i._onTick[e].fun.call(t)},this._ops.tickFrequency),function W(){var e,t,n,s,a,f,l,c;for(e in i._constantVelocities)n=i._constantVelocities[e],n.body.SetLinearVelocity(new r(n.x,n.y),n.body.GetWorldCenter());for(o=0;o<i._impulseQueue.length;o++)s=i._impulseQueue.pop(),s.body.ApplyImpulse(new r(s.x,s.y),s.body.GetWorldCenter());for(e in i._constantForces)a=i._constantForces[e],a.body.ApplyForce(new r(a.x,a.y),a.body.GetWorldCenter());for(e in i._entities)t=i._entities[e],n=t._body.GetLinearVelocity(),n.x>t._ops.maxVelocityX&&(n.x=t._ops.maxVelocityX),n.x<-t._ops.maxVelocityX&&(n.x=-t._ops.maxVelocityX),n.y>t._ops.maxVelocityY&&(n.y=t._ops.maxVelocityY),n.y<-t._ops.maxVelocityY&&(n.y=-t._ops.maxVelocityY);for(o=0;o<i._destroyQueue.length;o++)f=i._destroyQueue.pop(),l=f._id,u.DestroyBody(f._body),f._destroyed=!0,delete i._keydownHandlers[l],delete i._startContactHandlers[l],delete i._finishContactHandlers[l],delete i._impactHandlers[l],i._destroyQueue.splice(l,1),i._impulseQueue.splice(l,1),delete i._constantVelocities[l],delete i._constantForces[l],delete i._entities[l];u.Step(1/60,10,10);for(o=0;o<i._creationQueue.length;o++)i.createEntity(i._creationQueue.pop());for(o=0;o<i._positionQueue.length;o++)c=i._positionQueue.pop(),c.o.position.call(c.o,c.val);i._canvas.width=i._canvas.width;for(e in i._entities)t=i._entities[e],t._draw(i._ctx,t.canvasPosition().x,t.canvasPosition().y);for(o=0;o<i._onRender.length;o++)i._onRender[o].fun.call(i._onRender[o].ctx,i._ctx);u.ClearForces(),u.DrawDebugData(),i._pause===!1?window.requestAnimationFrame(W):i._pause=W}(),i._ops.disableKeyEvents||(window.addEventListener("keydown",function(e){for(var t in i._keydownHandlers)i._entities[t]._destroyed||i._keydownHandlers[t].call(i._entities[t],e)},!1),window.addEventListener("keyup",function(e){for(var t in i._keyupHandlers)i._entities[t]._destroyed||i._keyupHandlers[t].call(i._entities[t],e)},!1));var h=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;T(e,t);for(var o in i._mousedownHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mousedownHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mousedownHandlers[o].call(i._entities[o],e,t)},d=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;C(e,t);for(var o in i._mouseupHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mouseupHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mouseupHandlers[o].call(i._entities[o],e,t)},m=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;N(e,t);for(var o in i._mousemoveHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mousemoveHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mousemoveHandlers[o].call(i._entities[o],e,t)},g=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;s=i.find(n,r),t.entity=s.length>0?s[0]:null,O(e,t),i._mouseinHandlers[v]&&i._mouseinHandlers[v].call(i,e,t)},y=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;s=i.find(n,r),t.entity=s.length>0?s[0]:null,M(e,t),i._mouseoutHandlers[v]&&i._mouseoutHandlers[v].call(i,e,t)},b=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y;return t.entity=i.getEntityByPosition(n,r),t.touchIdentifier=e.identifier,t},w=function(e){var t=[],n;for(n=0;n<e.changedTouches.length;n++)e.changedTouches[n]&&t.push(b(e.changedTouches[n]));return t},E=function(e){var t=w(e),n,r;k(e,t);for(r in i._touchstartHandlers)if(r===v)i._touchstartHandlers[r].call(i,e,t);else for(n in t)t[n].entity&&t[n].entity._id==r&&!t[n].entity._destroyed&&i._touchstartHandlers[r].call(t[n].entity,e,t[n]);e.preventDefault()},S=function(e){var t=w(e),n,r;L(e,t);for(r in i._touchmoveHandlers)if(r===v)i._touchmoveHandlers[r].call(i,e,t);else for(n in t)t[n].entity&&t[n].entity._id==r&&!t[n].entity._destroyed&&i._touchmoveHandlers[r].call(t[n].entity,e,t[n]);e.preventDefault()},x=function(e){var t=w(e),n,r;A(e,t);for(r in i._touchendHandlers)if(r===v)i._touchendHandlers[r].call(i,e,t);else for(n in t)t[n].entity&&t[n].entity._id==r&&!t[n].entity._destroyed&&i._touchendHandlers[r].call(t[n].entity,e,t[n])},T=function(e,t){var n=t.x,r=t.y,s;if(i._mouseDraggingEntityId===null)for(var o in i._entities)!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._entities[o]._ops._mouseDraggable.disabled===!1&&_.call(i._entities[o],e,t);i._ops._mousePan.disabled===!1&&i._mouseDraggingEntityId===null&&(s=i.getEntityByPosition(n,r),(s===null||i._ops._mousePan.excludeEntityIds.indexOf(s._id)===-1)&&U.call(i,e,t))},N=function(e,t){i._mouseDraggingEntityId!==null&&i._entities[i._mouseDraggingEntityId]._mouseDragging&&_.call(i._entities[i._mouseDraggingEntityId],e,t),i._ops._mousePan.disabled===!1&&i._mousePanDragging&&U.call(i,e,t);var n=i._mouseHoverEntityId,r=null;for(var s in i._entities)!i._entities[s]._destroyed&&i._entities[s].checkPosition(t.x,t.y)&&(r=s);i._mouseHoverEntityId=r,n===null&&r!==null&&i._mouseinHandlers[r]&&i._mouseinHandlers[r].call(i._entities[r],e,t),n!==null&&r===null&&i._mouseoutHandlers[n]&&i._mouseoutHandlers[n].call(i._entities[n],e,t)},C=function(e,t){i._mouseDraggingEntityId!==null&&i._entities[i._mouseDraggingEntityId]._mouseDragging&&D.call(i._entities[i._mouseDraggingEntityId],e,t),i._ops._mousePan.disabled===!1&&i._mousePanDragging&&z.call(i,e,t)},k=function(e,t){var n;if(t.length>0)for(n in t)t[n].entity&&t[n].entity._ops._touchDraggable.disabled===!1&&I.call(i._entities[t[n].entity._id],e,t,n)},L=function(e,t){F=[];var n,r,s,o;if(i._touchDraggingEntityIds.length>0)for(n=0;n<e.changedTouches.length;n++)for(r in i._touchDraggingEntityIds)for(s in i._entities[i._touchDraggingEntityIds[r]]._touchMoveJoints)if(s==e.changedTouches[n].identifier)for(o=0;o<t.length;o++)t[o].touchIdentifier==s&&(F.indexOf(i._touchDraggingEntityIds[r])===-1&&F.push(i._touchDraggingEntityIds[r]),I.call(i._entities[i._touchDraggingEntityIds[r]],e,t,o));if(F.length>0)for(n=0;n<F.length;n++)i._touchDragHandlers[F[n]]&&i._touchDragHandlers[F[n]].call(i._entities[F[n]],e,H(t,i._entities[F[n]]))},A=function(e,t){var n,r,s,o;if(i._touchDraggingEntityIds.length>0)for(n=0;n<e.changedTouches.length;n++)for(r in i._touchDraggingEntityIds)for(s in i._entities[i._touchDraggingEntityIds[r]]._touchMoveJoints)if(s==e.changedTouches[n].identifier)for(o=0;o<t.length;o++)t[o].touchIdentifier==s&&q.call(i._entities[i._touchDraggingEntityIds[r]],e,t,o)},O=function(e,t){t.entity&&i._mouseinHandlers[t.entity._id]&&i._mouseinHandlers[t.entity._id].call(i._entities[t.entity._id],e,t)},M=function(e,t){i._mouseDraggingEntityId!==null&&i._entities[i._mouseDraggingEntityId]._mouseDragging&&D.call(i._entities[i._mouseDraggingEntityId],e,t),i._mousePanDragging&&z.call(i,e,t),i._mouseHoverEntityId!==null&&i._mouseoutHandlers[i._mouseHoverEntityId]&&i._mouseoutHandlers[i._mouseHoverEntityId].call(i._entities[i._mouseHoverEntityId],e,t)},_=function(e,t){if(this._world._mouseDraggingEntityId===null&&!this._mouseDragging&&!this._mouseStartDrag){this._mouseDragging=t,this._mouseStartDrag=!0,this._world._mouseDraggingEntityId=this._id;if(this._ops._mouseDraggable.type==="regularDrag"){if(!this._mouseMoveJoint){var n=new Box2D.Dynamics.Joints.b2MouseJointDef;n.bodyA=this._world._world.GetGroundBody(),n.bodyB=this._body,n.target.Set(t.x,t.y),n.maxForce=1e28,n.timeStep=1/60,this._mouseMoveJoint=this._world._world.CreateJoint(n)}}else this._ops._mouseDraggable.type==="eventDrag"}else this._mouseDragging&&(this._mouseStartDrag&&e.type==="mousemove"?(this._world._mouseStartdragHandlers[this._id]&&this._world._mouseStartdragHandlers[this._id].call(this,e,P(t,this._mouseDragging)),this._mouseStartDrag=!1):this._world._mouseDragHandlers[this._id]&&this._world._mouseDragHandlers[this._id].call(this,e,P(t,this._mouseDragging)));this._mouseMoveJoint&&this._mouseMoveJoint.SetTarget(new Box2D.Common.Math.b2Vec2(t.x,t.y))},D=function(e,t){this._mouseDragging&&(this._mouseMoveJoint&&(this._world._world.DestroyJoint(this._mouseMoveJoint),this._mouseMoveJoint=null),this._mouseStartDrag===!1&&this._world._mouseStopdragHandlers[this._id]&&this._world._mouseStopdragHandlers[this._id].call(this,e,P(t,this._mouseDragging))),this._mouseStartDrag=!1,this._mouseDragging=!1,this._world._mouseDraggingEntityId=null},P=function(e,t){var n={};return n.position={},n.position.x=e.x,n.position.y=e.y,t&&(n.originalPosition={},n.originalPosition.x=t.x,n.originalPosition.y=t.y),n},H=function(e,t){var n=t._id,r=[],i,s;for(i=0;i<e.length;i++)for(s in t._touchMoveJoints)s==e[i].touchIdentifier&&r.push({touchIdentifier:s,originalPosition:t._touchMoveJoints[s].originalPosition,position:{x:e[i].x,y:e[i].y}});return r},B=function(e,t,n){var r,i;this._touchMoveJoints||(this._touchMoveJoints={}),this._touchMoveJoints[t[n].touchIdentifier]&&this._touchMoveJoints[t[n].touchIdentifier].joint&&this._world._world.DestroyJoint(this._touchMoveJoints[t[n].touchIdentifier].joint),this._touchMoveJoints[t[n].touchIdentifier]={originalPosition:{x:t[n].x,y:t[n].y}},this._ops._touchDraggable.type==="regularDrag"?(r=new Box2D.Dynamics.Joints.b2MouseJointDef,r.bodyA=this._world._world.GetGroundBody(),r.bodyB=this._body,r.target.Set(t[n].x,t[n].y),r.maxForce=1e28,r.timeStep=1/60,this._touchMoveJoints[t[n].touchIdentifier].joint=this._world._world.CreateJoint(r)):this._ops._touchDraggable.type==="eventDrag",i=Object.keys(this._touchMoveJoints).length,i>1&&this._world._touchAddtouchdragHandlers[this._id]&&this._world._touchAddtouchdragHandlers[this._id].call(this,e,H(t,this)[0],i)},j=function(e,t,n){var r,i=H(t,this)[0];this._touchMoveJoints[t[n].touchIdentifier]&&(this._touchMoveJoints[t[n].touchIdentifier].joint&&this._world._world.DestroyJoint(this._touchMoveJoints[t[n].touchIdentifier].joint),this._touchMoveJoints[t[n].touchIdentifier]=null,delete this._touchMoveJoints[t[n].touchIdentifier]),r=Object.keys(this._touchMoveJoints).length,r>0&&this._world._touchRemovetouchdragHandlers[this._id]&&this._world._touchRemovetouchdragHandlers[this._id].call(this,e,i,r)},F=[],I=function(e,t,n){var r;e.type==="touchstart"&&this._world._touchDraggingEntityIds.indexOf(this._id)===-1&&!this._touchDragging&&!this._touchStartDrag?(this._body.SetSleepingAllowed(!1),this._touchDragging=!0,this._touchStartDrag=!0,this._world._touchDraggingEntityIds.push(this._id),B.call(this,e,t,n)):e.type==="touchstart"&&this._world._touchDraggingEntityIds.indexOf(this._id)>-1?Object.keys(this._touchMoveJoints).length<this._ops._touchDraggable.maxTouches&&B.call(this,e,t,n):this._touchDragging&&this._touchStartDrag&&e.type==="touchmove"&&(this._world._touchStartdragHandlers[this._id]&&this._world._touchStartdragHandlers[this._id].call(this,e,H(t,this)[0]),this._touchStartDrag=!1),this._touchMoveJoints&&this._touchMoveJoints[t[n].touchIdentifier].joint&&this._touchMoveJoints[t[n].touchIdentifier].joint.SetTarget(new Box2D.Common.Math.b2Vec2(t[n].x,t[n].y))},q=function(e,t,n){var r=H(t,this)[0];j.call(this,e,t,n),Object.keys(this._touchMoveJoints).length===0&&(this._body.SetSleepingAllowed(!0),this._touchStartDrag===!1&&i._touchStopdragHandlers[this._id]&&i._touchStopdragHandlers[this._id].call(this,e,r),this._touchStartDrag=!1,this._touchDragging=!1,this._world._touchDraggingEntityIds.splice(this._world._touchDraggingEntityIds.indexOf(this._id),1))},R=function(e,t){var n={x:(t.offsetX||t.layerX||t.pageX)/this.scale(),y:(t.offsetY||t.layerY||t.pageY)/this.scale()},r;return r={originalViewport:{x:e.originalViewport.x,y:e.originalViewport.y,width:e.originalViewport.width,height:e.originalViewport.height,scale:e.originalViewport.scale},viewport:{x:e.originalViewport.x-(n.x-e.originalRelativeMousePos.x)*this._ops._mousePan.multiplier,y:e.originalViewport.y-(n.y-e.originalRelativeMousePos.y)*this._ops._mousePan.multiplier,width:e.originalViewport.width,height:e.originalViewport.height,scale:e.originalViewport.scale}},r},U=function(e){var t,n={x:(e.offsetX||e.layerX||e.pageX)/this.scale(),y:(e.offsetY||e.layerY||e.pageY)/this.scale()};!this._mousePanDragging&&!this._mousePanStartDrag?(this._mousePanDragging={originalViewport:this.viewport.getCurrentWindowInfos(),originalRelativeMousePos:n},this._mousePanStartDrag=!0):this._mousePanDragging&&(t=R.call(this,this._mousePanDragging,e,"move"),this.camera({x:t.viewport.x,y:t.viewport.y}),this._mousePanStartDrag&&e.type==="mousemove"?(this._mousePanStartdragHandler&&this._mousePanStartdragHandler.call(this,e,t),this._mousePanStartDrag=!1):this._mousePanDragHandler&&this._mousePanDragHandler.call(this,e,t))},z=function(e,t){var n;this._mousePanDragging&&(n=R.call(this,this._mousePanDragging,e),this._mousePanStartDrag===!1&&this._mousePanStopdragHandler&&this._mousePanStopdragHandler.call(this,e,n,"stop"),this.camera({x:n.viewport.x,y:n.viewport.y})),this._mousePanStartDrag=!1,this._mousePanDragging=!1};i._ops.disableTouchEvents||(i._canvas.addEventListener("touchstart",E,!1),i._canvas.addEventListener("touchmove",S,!1),i._canvas.addEventListener("touchend",x,!1)),i._ops.disableMouseEvents||(i._canvas.addEventListener("mousedown",h,!1),i._canvas.addEventListener("mouseup",d,!1),i._canvas.addEventListener("mousemove",m,!1),i._canvas.addEventListener("mouseover",g,!1),i._canvas.addEventListener("mouseout",y,!1)),i._ops.preventScroll&&document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1),a=new Box2D.Dynamics.b2ContactListener,a.BeginContact=function(e){var t=i._entities[e.GetFixtureA().GetBody()._bbid],n=i._entities[e.GetFixtureB().GetBody()._bbid];for(var r in i._startContactHandlers)t._id===Number(r)&&!t._destroyed&&i._startContactHandlers[r].call(i._entities[r],n),n._id===Number(r)&&!n._destroyed&&i._startContactHandlers[r].call(i._entities[r],t)},a.EndContact=function(e){var t=i._entities[e.GetFixtureA().GetBody()._bbid],n=i._entities[e.GetFixtureB().GetBody()._bbid];for(var r in i._finishContactHandlers)t._id===Number(r)&&!t._destroyed&&i._finishContactHandlers[r].call(i._entities[r],n),n._id===Number(r)&&!n._destroyed&&i._finishContactHandlers[r].call(i._entities[r],t)},a.PostSolve=function(e,t){var n=i._entities[e.GetFixtureA().GetBody()._bbid],r=i._entities[e.GetFixtureB().GetBody()._bbid];for(var s in i._impactHandlers)n._id===Number(s)&&!n._destroyed&&i._impactHandlers[s].call(i._entities[s],r,t.normalImpulses[0],t.tangentImpulses[0]),r._id===Number(s)&&!r._destroyed&&i._impactHandlers[s].call(i._entities[s],n,t.normalImpulses[0],t.tangentImpulses[0])},u.SetContactListener(a)}},checkListenersOptions:function(){var e=[];this._ops.disableTouchEvents&&this._ops.disableMouseEvents&&this._ops.disableKeyEvents&&("ontouchstart"in window&&(this._ops.disableTouchEvents=!1,e.push("touchEvents")),"mousedown"in window&&(this._ops.disableMouseEvents=!1,e.push("mouseEvents")),"onkeydown"in window&&(this._ops.disableKeyEvents=!1,e.push("keyEvents")),console.warn('All events were disabled in your config. The following available events on your device have been enabled : "'+e.join(", ")+'"'))},pause:function(){this._pause===!1?this._pause=!0:(window.requestAnimationFrame(this._pause),this._pause=!1)},_addKeydownHandler:function(e,t){this._keydownHandlers[e]=t},_addKeyupHandler:function(e,t){this._keyupHandlers[e]=t},_addMousedownHandler:function(e,t){this._mousedownHandlers[e]=t},_addMouseupHandler:function(e,t){this._mouseupHandlers[e]=t},_addMousemoveHandler:function(e,t){this._mousemoveHandlers[e]=t},_removeMousedownHandler:function(e){delete this._mousedownHandlers[e]},_removeMouseupHandler:function(e){delete this._mouseupHandlers[e]},_removeMousemoveHandler:function(e){delete this._mousemoveHandlers[e]},_addTouchstartHandler:function(e,t){this._touchstartHandlers[e]=t},_addTouchendHandler:function(e,t){this._touchendHandlers[e]=t},_addTouchmoveHandler:function(e,t){this._touchmoveHandlers[e]=t},_removeTouchstartHandler:function(e){delete this._touchstartHandlers[e]},_removeTouchendHandler:function(e){delete this._touchendHandlers[e]},_removeTouchmoveHandler:function(e){delete this._touchmoveHandlers[e]},_addMouseStartdragHandler:function(e,t){this._mouseStartdragHandlers[e]=t},_addMouseDragHandler:function(e,t){this._mouseDragHandlers[e]=t},_addMouseStopdragHandler:function(e,t){this._mouseStopdragHandlers[e]=t},_addMouseinHandler:function(e,t){this._mouseinHandlers[e]=t},_addMouseoutHandler:function(e,t){this._mouseoutHandlers[e]=t},_removeMouseinHandler:function(e){delete this._mouseinHandlers[e]},_removeMouseoutHandler:function(e){delete this._mouseoutHandlers[e]},_removeMouseStartdragHandler:function(e){delete this._mouseStartdragHandlers[e]},_removeMouseDragHandler:function(e){delete this._mouseDragHandlers[e]},_removeMouseStopdragHandler:function(e){delete this._mouseStopdragHandlers[e]},_addTouchStartdragHandler:function(e,t){this._touchStartdragHandlers[e]=t},_addTouchDragHandler:function(e,t){this._touchDragHandlers[e]=t},_addTouchStopdragHandler:function(e,t){this._touchStopdragHandlers[e]=t},_removeTouchStartdragHandler:function(e){delete this._touchStartdragHandlers[e]},_removeTouchDragHandler:function(e){delete this._touchDragHandlers[e]},_removeTouchStopdragHandler:function(e){delete this._touchStopdragHandlers[e]},_addTouchAddtouchDragHandler:function(e,t){this._touchAddtouchdragHandlers[e]=t},_addTouchRemovetouchDragHandler:function(e,t){this._touchRemovetouchdragHandlers[e]=t},_removeTouchAddtouchDragHandler:function(e){delete this._touchAddtouchdragHandlers[e]},_removeTouchRemovetouchDragHandler:function(e){delete this._touchRemovetouchdragHandlers[e]},_addStartContactHandler:function(e,t){this._startContactHandlers[e]=t},_addFinishContactHandler:function(e,t){this._finishContactHandlers[e]=t},_addImpactHandler:function(e,t){this._impactHandlers[e]=t},_destroy:function(e){this._destroyQueue.push(e)},_applyImpulse:function(e,t,n,r){this._impulseQueue.push({id:e,body:t,x:n,y:r})},_setConstantVelocity:function(e,t,n,r,i){this._constantVelocities[e+t]={id:t,body:n,x:r,y:i}},_clearConstantVelocity:function(e,t){delete this._constantVelocities[e+t]},_setConstantForce:function(e,t,n,r,i){this._constantForces[e+t]={id:t,body:n,x:r,y:i}},_clearConstantForce:function(e,t){delete this._constantForces[e+t]},_addMouseDraggableEntityId:function(e){this._mouseDraggableEntityIds.indexOf(e)===-1&&this._mouseDraggableEntityIds.push(e)},_addTouchDraggableEntityId:function(e){this._touchDraggableEntityIds.indexOf(e)===-1&&this._touchDraggableEntityIds.push(e)},_removeMouseDraggableEntityId:function(e){var t=this._mouseDraggableEntityIds.indexOf(e);t>-1&&this._mouseDraggableEntityIds.splice(t,1)},_removeTouchDraggableEntityId:function(e){var t=this._touchDraggableEntityIds.indexOf(e);t>-1&&this._touchDraggableEntityIds.splice(t,1)},_addMousePanExcludeEntityId:function(e){this._ops._mousePan.excludeEntityIds.indexOf(e)===-1&&this._ops._mousePan.excludeEntityIds.push(e)},_addTouchPanExcludeEntityId:function(e){this._ops._touchPan.excludeEntityIds.indexOf(e)===-1&&this._ops._touchPan.excludeEntityIds.push(e)},_removeMousePanExcludeEntityId:function(e){var t=this._ops._mousePan.excludeEntityIds.indexOf(e);t>-1&&this._ops._mousePan.excludeEntityIds.splice(t,1)},_removeTouchPanExcludeEntityId:function(e){var t=this._ops._touchPan.excludeEntityIds.indexOf(e);t>-1&&this._ops._touchPan.excludeEntityIds.splice(t,1)},calculateWorldPositionFromPointer:function(e){return{x:(e.offsetX||e.layerX||e.pageX)/this.scale()+this._cameraX,y:(e.offsetY||e.layerY||e.pageY)/this.scale()+this._cameraY}},gravity:function(e){e!==undefined&&this._world.SetGravity(new r(0,e));var t=this._world.GetGravity();return{x:t.x,y:t.y}},createEntity:function(){var e={},r=Array.prototype.slice.call(arguments);r.reverse();for(var i in r)n(e,r[i]);if(this._world.IsLocked()){this._creationQueue.push(e);return}var s=t(y),o=this._nextEntityId++;return s._init(this,e,o),this._entities[o]=s,s},createJoint:function(e,t,r){r=r||{},r=n(r,d);var i=r.type,s;i==="distance"?s=new Box2D.Dynamics.Joints.b2DistanceJointDef:i==="revolute"?s=new Box2D.Dynamics.Joints.b2RevoluteJointDef:i==="gear"?s=new Box2D.Dynamics.Joints.b2GearJointDef:i==="friction"?s=new Box2D.Dynamics.Joints.b2FrictionJointDef:i==="prismatic"?s=new Box2D.Dynamics.Joints.b2PrismaticJointDef:i==="weld"?s=new Box2D.Dynamics.Joints.b2WeldJointDef:i==="pulley"?s=new Box2D.Dynamics.Joints.b2PulleyJointDef:i==="mouse"?s=new Box2D.Dynamics.Joints.b2MouseJointDef:i==="line"&&(s=new Box2D.Dynamics.Joints.b2LineJointDef),r.enableMotor&&(s.enableMotor=!0);var o=e._body.GetWorldCenter();r.jointPositionOnEntity1&&(o.x+=r.jointPositionOnEntity1.x,o.y+=r.jointPositionOnEntity1.y);var u=t._body.GetWorldCenter();r.jointPositionOnEntity2&&(u.x+=r.jointPositionOnEntity2.x,u.y+=r.jointPositionOnEntity2.y),i==="mouse"?(s.bodyA=e._body,s.bodyB=t._body):s.Initialize&&s.Initialize(e._body,t._body,o,u),r.allowCollisions&&(s.collideConnected=!0),this._world.CreateJoint(s)},find:function(e,t,n,r){n===undefined&&(n=e),r===undefined&&(r=t);var i=this,s=[],o=new h;return o.lowerBound.Set(e,t),o.upperBound.Set(n,r),this._world.QueryAABB(function(e){return s.push(i._entities[e.GetBody()._bbid]),!0},o),s},getEntityByPosition:function(e,t){var n=null;return this._world.QueryPoint(function(e){n=e.GetBody()},new r(e,t)),n!==null&&this._entities[n._bbid]?this._entities[n._bbid]:null},camera:function(e){e=e||{};if(e.x===undefined&&e.y===undefined)return{x:this._cameraX,y:this._cameraY};e.x!==undefined&&(this._cameraX=e.x),e.y!==undefined&&(this._cameraY=e.y)},onRender:function(e){this._onRender.push({fun:e,ctx:this})},unbindOnRender:function(e){var t=[],n;for(n=0;n<this._onRender.length;n++)this._onRender[n].fun!==e&&t.push(this._onRender[n]);this._onRender=t},onTick:function(e){this._onTick.push({fun:e,ctx:this})},unbindOnTick:function(e){var t=[],n;for(n=0;n<this._onTick.length;n++)this._onTick[n].fun!==e&&t.push(this._onTick[n]);this._onTick=t},scale:function(e){return e!==undefined&&(this._scale=e),this._scale},canvasPositionAt:function(e,t){var n=this.camera(),r=this.scale();return{x:Math.round((e+ -n.x)*r),y:Math.round((t+ -n.y)*r)}},onMousedown:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousedown"),!1;this._addMousedownHandler(v,e)},onMouseup:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseup"),!1;this._addMouseupHandler(v,e)},onMousemove:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousemove"),!1;this._addMousemoveHandler(v,e)},unbindOnMousedown:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousedown"),!1;this._removeMousedownHandler(v)},unbindOnMouseup:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseup"),!1;this._removeMouseupHandler(v)},unbindOnMousemove:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousemove"),!1;this._removeMousemoveHandler(v)},onMousein:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousein"),!1;this._addMouseinHandler(v,e)},onMouseout:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseout"),!1;this._addMouseoutHandler(v,e)},unbindOnMousein:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousein"),!1;this._removeMouseinHandler(v)},unbindOnMouseout:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseout"),!1;this._removeMouseoutHandler(v)},onTouchstart:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchstart"),!1;this._addTouchstartHandler(v,e)},onTouchmove:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchmove"),!1;this._addTouchmoveHandler(v,e)},onTouchend:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchend"),!1;this._addTouchendHandler(v,e)},unbindOnTouchstart:function(){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchstart"),!1;this._removeTouchstartHandler(v)},unbindOnTouchmove:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchmove"),!1;this._removeTouchmoveHandler(v)},unbindOnTouchend:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchend"),!1;this._removeTouchendHandler(v)},mousePan:function(e,t){var n,r;if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call mousePan"),!1;this._ops._mousePan.excludeEntityIds||(this._ops._mousePan.excludeEntityIds=[]);if(typeof e=="undefined")this._ops._mousePan.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._mousePan.disabled=!0;break;case"enable":this._ops._mousePan.disabled=!1;break;case"exclude":t.length||(r=t,t=[],t.push(r));for(n=0;n<t.length;n++)this._addMousePanExcludeEntityId(t[n]);break;case"include":t.length||(r=t,t=[],t.push(r));for(n=0;n<t.length;n++)this._removeMousePanExcludeEntityId(t[n])}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._mousePan.disabled=e.disabled:this._ops._mousePan.disabled=!1,typeof e.excludeEntityIds!="undefined"&&e.excludeEntityIds!==!1?this._ops._mousePan.excludeEntityIds=typeof e.excludeEntityIds=="number"?[e.excludeEntityIds]:e.excludeEntityIds:e.excludeEntityIds===!1&&(this._ops._mousePan.excludeEntityIds=[]),typeof e.multiplier=="number"?this._ops._mousePan.multiplier=e.multiplier:typeof e.multiplier!="undefined"&&(this._ops._mousePan.multiplier=1),typeof e.start=="function"?this._mousePanStartdragHandler=e.start:typeof e.start!="undefined"&&(this._mousePanStartdragHandler=null),typeof e.drag=="function"?this._mousePanDragHandler=e.drag:typeof e.drag!="undefined"&&(this._mousePanDragHandler=null),typeof e.stop=="function"?this._mousePanStopdragHandler=e.stop:typeof e.stop!="undefined"&&(this._mousePanStopdragHandler=null))},isMousePanEnabled:function(){return!this._ops._mousePan.disabled},touchPan:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call touchPan"),!1},isTouchPanEnabled:function(){return!this._ops._touchPan.disabled}},g={name:"unnamed object",x:10,y:5,type:"dynamic",shape:"square",height:1,width:1,radius:1,points:[{x:0,y:0},{x:2,y:0},{x:0,y:2}],density:2,friction:1,restitution:.2,active:!0,rotation:null,fixedRotation:!1,bullet:!1,maxVelocityX:1e3,maxVelocityY:1e3,image:null,imageOffsetX:0,imageOffsetY:0,imageStretchToFit:null,color:"gray",borderColor:"black",borderWidth:1,spriteSheet:!1,spriteWidth:16,spriteHeight:16,spriteX:0,spriteY:0,_mouseDraggable:{disabled:!0,type:"regularDrag"},_touchDraggable:{disabled:!0,type:"regularDrag",maxTouches:100},init:null,draw:function(e,t,n){var r=-this._world._cameraX,s=-this._world._cameraY;e.fillStyle=this._ops.color,e.strokeStyle=this._ops.borderColor,e.lineWidth=this._ops.borderWidth;var o,u=this._world._scale,a=this._world._ops.collisionOutlines,f=this._ops.imageOffsetX||0,l=this._ops.imageOffsetY||0;f*=u,l*=u;if(this._sprite!==undefined){var c,h;this._ops.shape==="circle"&&this._ops.imageStretchToFit?(c=h=this._ops.radius*2,t-=this._ops.radius/2*u,n-=this._ops.radius/2*u):this._ops.imageStretchToFit?(c=this._ops.width,h=this._ops.height):this._ops.spriteSheet?(c=this._ops.spriteWidth/30,h=this._ops.spriteHeight/30):(c=this._sprite.width/30,h=this._sprite.height/30);var p=f+(t+c/4*u),d=l+(n+h/4*u);e.translate(p,d),e.rotate(this._body.GetAngle()),this._ops.spriteSheet?e.drawImage(this._sprite,this._ops.spriteX*this._ops.spriteWidth,this._ops.spriteY*this._ops.spriteHeight,this._ops.spriteWidth,this._ops.spriteHeight,-(c/2*u),-(h/2*u),c*u,h*u):e.drawImage(this._sprite,-(c/2*u),-(h/2*u),c*u,h*u),e.rotate(0-this._body.GetAngle()),e.translate(-p,-d)}if(this._sprite&&!a)return;a&&(this._sprite!==undefined&&(e.fillStyle="transparent"),e.strokeStyle="rgb(255, 0, 255)",e.lineWidth=2);if(this._ops.shape==="polygon"||this._ops.shape==="square"){var v=this._body.GetFixtureList().GetShape(),m=parseInt(v.GetVertexCount(),10),g=v.GetVertices(),y=new Vector(m),b=this._body.m_xf;for(o=0;o<m;++o)y[o]=i.MulX(b,g[o]);e.beginPath(),e.moveTo((r+y[0].x)*u,(s+y[0].y)*u);for(o=1;o<y.length;o++)e.lineTo((r+y[o].x)*u,(s+y[o].y)*u);e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}else if(this._ops.shape==="circle"){var w=this.position();e.beginPath(),e.arc((r+w.x)*u,(s+w.y)*u,this._ops.radius*u,0,Math.PI*2,!0),e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}}},y={_id:null,_ops:null,_body:null,_world:null,_init:function(t,r,i){var a,f;r&&r.components!==undefined&&(r.components.reverse(),r.components.forEach(function(e){n(r,e)})),this._ops=n(r,g),a=this._ops,this._body=new s;var c=this._body;this._world=t,this._id=i;for(f in this._ops)f.match(/^\$/)&&(this[f]=this._ops[f]);var h=new u;h.density=a.density,h.friction=a.friction,h.restitution=a.restitution,c.position.x=a.x,c.position.y=a.y,this._name=a.name,a.type==="static"?c.type=o.b2_staticBody:a.type==="dynamic"&&(c.type=o.b2_dynamicBody),a.shape==="square"?(h.shape=new l.b2PolygonShape,h.shape.SetAsBox(a.width/2,a.height/2)):a.shape==="circle"?h.shape=new l.b2CircleShape(a.radius):a.shape==="polygon"&&(h.shape=new l.b2PolygonShape,h.shape.SetAsArray(a.points,a.points.length)),a.rotation&&(c.angle=a.rotation/e),a.draw&&(this._draw=a.draw),a.image&&(this._sprite=new Image,this._sprite.src=a.image),c.active=a.active,c.fixedRotation=a.fixedRotation,c.bullet=a.bullet,this._body=t._world.CreateBody(c),this._body.CreateFixture(h),this._body._bbid=i,a.onStartContact&&this._world._addStartContactHandler(i,a.onStartContact),a.onFinishContact&&this._world._addFinishContactHandler(i,a.onFinishContact),a.onImpact&&this._world._addImpactHandler(i,a.onImpact),a.onKeyDown&&this._world._addKeydownHandler(i,a.onKeyDown),a.onKeyUp&&this._world._addKeyupHandler(i,a.onKeyUp),a.onRender&&this.onRender(a.onRender),a.onTick&&this.onTick(a.onTick),a.init&&a.init.call(this)},_toVector:function(e,t,n){var r,i;return t=t||0,n===undefined?(t-=90,r=Math.cos(t*(Math.PI/180))*e,i=Math.sin(t*(Math.PI/180))*e):(r=t*e,i=n*e),{x:r,y:i}},name:function(e){return e!==undefined&&(this._name=e),this._name},position:function(e){e!==undefined&&(this._world._world.IsLocked()?this._world._positionQueue.push({o:this,val:e}):this._body.SetPosition(new r(e.x,e.y)));var t=this._body.GetPosition();return{x:t.x,y:t.y}},checkPosition:function(e,t){var n;if(this._body.GetType()!==o.b2_staticBody)this._world._world.QueryPoint(function(e){n=e.GetBody()},new r(e,t));else{var i=new h;i.lowerBound.Set(e-.001,t-.001),i.upperBound.Set(e-.001,t-.001),this._world._world.QueryAABB(function(e){n=e.GetBody()},i)}return n!==undefined&&this._id===n._bbid?!0:!1},canvasPosition:function(e){e!==undefined;var t=this.position();return this._world.canvasPositionAt(t.x,t.y)},rotation:function(t){return t!==undefined&&this._body.SetAngle(t/e),this._body.GetAngle()*e},friction:function(e){return e!==undefined&&this._body.GetFixtureList().SetFriction(e),this._body.GetFixtureList().GetFriction()},restitution:function(e){return e!==undefined&&this._body.GetFixtureList().SetRestitution(e),this._body.GetFixtureList().GetRestitution()},maxVelocityX:function(e){return e!==undefined&&(this._ops.maxVelocityX=e),this._ops.maxVelocityX},maxVelocityY:function(e){return e!==undefined&&(this._ops.maxVelocityY=e),this._ops.maxVelocityY},image:function(e){return e!==undefined&&(this._sprite=new Image,this._sprite.src=e),this._sprite.src},imageOffsetX:function(e){return e!==undefined&&(this._ops.imageOffsetX=e),this._ops.imageOffsetX},imageOffsetY:function(e){return e!==undefined&&(this._ops.imageOffsetY=e),this._ops.imageOffsetY},imageStretchToFit:function(e){return e!==undefined&&(this._ops.imageStretchToFit=e),this._ops.imageStretchToFit},color:function(e){return e!==undefined&&(this._ops.color=e),this._ops.color},borderColor:function(e){return e!==undefined&&(this._ops.borderColor=e),this._ops.borderColor},borderWidth:function(e){return e!==undefined&&(this._ops.borderWidth=e),this._ops.borderWidth},spriteSheet:function(e){return e!==undefined&&(this._ops.spriteSheet=e),this._ops.spriteSheet},spriteWidth:function(e){return e!==undefined&&(this._ops.spriteWidth=e),this._ops.spriteWidth},spriteHeight:function(e){return e!==undefined&&(this._ops.spriteHeight=e),this._ops.spriteHeight},draw:function(e){return e!==undefined&&(this._draw=e),this._draw},destroy:function(){this._destroyed=!0,this._world._destroy(this)},applyImpulse:function(e,t,n){var r=this._toVector(e,t,n);this._world._applyImpulse(this._id,this._body,r.x,r.y)},setForce:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantForce(e,this._id,this._body,i.x,i.y)},setVelocity:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantVelocity(e,this._id,this._body,i.x,i.y)},clearForce:function(e){this._world._clearConstantForce(e,this._id)},clearVelocity:function(e){this._world._clearConstantVelocity(e,this._id)},onKeydown:function(e){if(this._world._ops.disableKeyEvents)return console.warn("Key events are disabled, you tried to call onKeydown"),!1;this._world._addKeydownHandler(this._id,e)},onKeyup:function(e){if(this._world._ops.disableKeyEvents)return console.warn("Key events are disabled, you tried to call onKeyup"),!1;this._world._addKeyupHandler(this._id,e)},onMousedown:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousedown"),!1;this._world._addMousedownHandler(this._id,e)},onMouseup:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseup"),!1;this._world._addMouseupHandler(this._id,e)},onMousemove:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousemove"),!1;this._world._addMousemoveHandler(this._id,e)},unbindOnMousedown:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousedown"),!1;this._world._removeMousedownHandler(this._id)},unbindOnMouseup:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseup"),!1;this._world._removeMouseupHandler(this._id)},unbindOnMousemove:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousemove"),!1;this._world._removeMousemoveHandler(this._id)},onMousein:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousein"),!1;this._ops.active===!1&&console.warn("onMousein only on active objects"),this._world._addMouseinHandler(this._id,e)},onMouseout:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseout"),!1;this._ops.active===!1&&console.warn("onMousein only on active objects"),this._world._addMouseoutHandler(this._id,e)},unbindOnMousein:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousein"),!1;this._world._removeMouseinHandler(this._id)},unbindOnMouseout:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseout"),!1;this._world._removeMouseoutHandler(this._id)},onTouchstart:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchstart"),!1;this._world._addTouchstartHandler(this._id,e)},onTouchend:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchend"),!1;this._world._addTouchendHandler(this._id,e)},onTouchmove:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchmove"),!1;this._world._addTouchmoveHandler(this._id,e)},unbindOnTouchstart:function(){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchstart"),!1;this._world._removeTouchstartHandler(this._id)},unbindOnTouchend:function(){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchend"),!1;this._world._removeTouchendHandler(this._id)},unbindOnTouchmove:function(){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchmove"),!1;this._world._removeTouchmoveHandler(this._id)},onStartContact:function(e){this._world._addStartContactHandler(this._id,e)},onFinishContact:function(e){this._world._addFinishContactHandler(this._id,e)},onImpact:function(e){this._world._addImpactHandler(this._id,e)},onRender:function(e){this._world._onRender.push({fun:e,ctx:this})},onTick:function(e){this._world._onTick.push({fun:e,ctx:this})},sprite:function(e,t){this._ops.spriteX=e,this._ops.spriteY=t},pin:function(e,t){this.isPined()&&this.unPin();var n=this.position(),i,s,o,u;e=e||n.x,t=t||n.y,u=this._body.GetLocalPoint(new r(e,t)),s=u.x,o=u.y,i=new Box2D.Dynamics.Joints.b2RevoluteJointDef,i.bodyA=this._world._world.GetGroundBody(),i.bodyB=this._body,i.target&&i.target.Set?i.target.Set(e,t):i.localAnchorA.Set(e,t),i.localAnchorB.Set(s,o),i.maxForce=1e28,i.timeStep=1/60,this._pinJoint=this._world._world.CreateJoint(i)},unPin:function(){this._pinJoint&&(this._world._world.DestroyJoint(this._pinJoint),this._pinJoint=null)},isPined:function(){return this._pinJoint?!0:!1},mouseDraggable:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call mouseDraggable"),!1;if(typeof e=="undefined")this._ops._mouseDraggable.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._mouseDraggable.disabled=!0;break;case"enable":this._ops._mouseDraggable.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._mouseDraggable.disabled=e.disabled:this._ops._mouseDraggable.disabled=!1,typeof e.type=="string"&&(this._ops._mouseDraggable.type=e.type),typeof e.start=="function"?this._world._addMouseStartdragHandler(this._id,e.start):typeof e.start!="undefined"&&this._world._removeMouseStartdragHandler(this._id),typeof e.drag=="function"?this._world._addMouseDragHandler(this._id,e.drag):typeof e.drag!="undefined"&&this._world._removeMouseDragHandler(this._id),typeof e.stop=="function"?this._world._addMouseStopdragHandler(this._id,e.stop):typeof e.stop!="undefined"&&this._world._removeMouseStopdragHandler(this._id));this._ops._mouseDraggable.disabled===!1?this._world._addMouseDraggableEntityId(this._id):this._world._removeMouseDraggableEntityId(this._id)},isMouseDraggable:function(){return!this._ops._mouseDraggable.disabled},touchDraggable:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Mouse events are disabled, you tried to call mouseDraggable"),!1;if(typeof e=="undefined")this._ops._touchDraggable.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._touchDraggable.disabled=!0;break;case"enable":this._ops._touchDraggable.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._touchDraggable.disabled=e.disabled:this._ops._touchDraggable.disabled=!1,e.maxTouches>0?this._ops._touchDraggable.maxTouches=e.maxTouches:this._ops._touchDraggable.maxTouches=100,typeof e.type=="string"&&(this._ops._touchDraggable.type=e.type),typeof e.start=="function"?this._world._addTouchStartdragHandler(this._id,e.start):typeof e.start!="undefined"&&this._world._removeTouchStartdragHandler(this._id),typeof e.drag=="function"?this._world._addTouchDragHandler(this._id,e.drag):typeof e.drag!="undefined"&&this._world._removeTouchDragHandler(this._id),typeof e.stop=="function"?this._world._addTouchStopdragHandler(this._id,e.stop):typeof e.stop!="undefined"&&this._world._removeTouchStopdragHandler(this._id),typeof e.touchadd=="function"?this._world._addTouchAddtouchDragHandler(this._id,e.touchadd):typeof e.touchadd!="undefined"&&this._world._removeTouchAddtouchDragHandler(this._id),typeof e.touchremove=="function"?this._world._addTouchRemovetouchDragHandler(this._id,e.touchremove):typeof e.touchremove!="undefined"&&this._world._removeTouchRemovetouchDragHandler(this._id));this._ops._touchDraggable.disabled===!1?this._world._addTouchDraggableEntityId(this._id):this._world._removeTouchDraggableEntityId(this._id)},isTouchDraggable:function(){return!this._ops._touchDraggable.disabled}}}();