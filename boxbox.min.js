/* Copyright 2013 Christophe Rosset. Licensed under the MIT License. http://topheman.github.com/boxbox/ */
/* Copyright 2012 Greg Smith. Licensed under the MIT License. http://incompl.github.com/boxbox/ */
(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),function(){function t(e){function t(){}return t.prototype=e,new t}function n(e,t){e===undefined&&(e={});if(t!==undefined)for(var n in t)t.hasOwnProperty(n)&&e[n]===undefined&&(e[n]=t[n]);return e}var e=57.2957795;window.boxbox={};if(Box2D===undefined){console.error("boxbox needs Box2d to work");return}var r=Box2D.Common.Math.b2Vec2,i=Box2D.Common.Math.b2Math,s=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2Body,u=Box2D.Dynamics.b2FixtureDef,a=Box2D.Dynamics.b2Fixture,f=Box2D.Dynamics.b2World,l=Box2D.Collision.Shapes,c=Box2D.Dynamics.b2DebugDraw,h=Box2D.Collision.b2AABB;window.boxbox.createWorld=function(e,n){var r=t(m);return r._init(e,n),r};var p={gravity:{x:0,y:10},allowSleep:!0,scale:30,tickFrequency:50,collisionOutlines:!1,disableTouchEvents:!1,disableMouseEvents:!1,disableKeyEvents:!1,preventScroll:!1},d={type:"distance",allowCollisions:!1},v="world",m={_ops:null,_world:null,_canvas:null,_keydownHandlers:{},_keyupHandlers:{},_mousedownHandlers:{},_mouseupHandlers:{},_mousemoveHandlers:{},_mouseinHandlers:{},_mouseoutHandlers:{},_startdragHandlers:{},_dragHandlers:{},_stopdragHandlers:{},_touchstartHandlers:{},_touchendHandlers:{},_touchmoveHandlers:{},_touchcancelHandlers:{},_startContactHandlers:{},_finishContactHandlers:{},_impactHandlers:{},_destroyQueue:[],_impulseQueue:[],_constantVelocities:{},_constantForces:{},_entities:{},_nextEntityId:0,_cameraX:0,_cameraY:0,_onRender:[],_onTick:[],_creationQueue:[],_positionQueue:[],_pause:!1,_hoverEntityId:null,_draggingEntityId:null,_init:function(e,t){var i=this,s,o,u,a;this._ops=n(t,p),this.checkListenersOptions(),this._world=new f(new r(this._ops.gravity.x,this._ops.gravity.y),!0),u=this._world,this._canvas=e,this._ctx=this._canvas.getContext("2d"),this._scale=this._ops.scale;if(this._canvas!==undefined){if(this._ops.debugDraw){var l=new c;l.SetSprite(this._canvas.getContext("2d")),l.SetDrawScale(this._scale),l.SetFillAlpha(.3),l.SetLineThickness(1),l.SetFlags(c.e_shapeBit|c.e_jointBit),u.SetDebugDraw(l)}window.setInterval(function(){var e,t;for(e=0;e<i._onTick.length;e++)t=i._onTick[e].ctx,t._destroyed||i._onTick[e].fun.call(t)},this._ops.tickFrequency),function B(){var e,t,n,s,a,f,l,c;for(e in i._constantVelocities)n=i._constantVelocities[e],n.body.SetLinearVelocity(new r(n.x,n.y),n.body.GetWorldCenter());for(o=0;o<i._impulseQueue.length;o++)s=i._impulseQueue.pop(),s.body.ApplyImpulse(new r(s.x,s.y),s.body.GetWorldCenter());for(e in i._constantForces)a=i._constantForces[e],a.body.ApplyForce(new r(a.x,a.y),a.body.GetWorldCenter());for(e in i._entities)t=i._entities[e],n=t._body.GetLinearVelocity(),n.x>t._ops.maxVelocityX&&(n.x=t._ops.maxVelocityX),n.x<-t._ops.maxVelocityX&&(n.x=-t._ops.maxVelocityX),n.y>t._ops.maxVelocityY&&(n.y=t._ops.maxVelocityY),n.y<-t._ops.maxVelocityY&&(n.y=-t._ops.maxVelocityY);for(o=0;o<i._destroyQueue.length;o++)f=i._destroyQueue.pop(),l=f._id,u.DestroyBody(f._body),f._destroyed=!0,delete i._keydownHandlers[l],delete i._startContactHandlers[l],delete i._finishContactHandlers[l],delete i._impactHandlers[l],i._destroyQueue.splice(l,1),i._impulseQueue.splice(l,1),delete i._constantVelocities[l],delete i._constantForces[l],delete i._entities[l];u.Step(1/60,10,10);for(o=0;o<i._creationQueue.length;o++)i.createEntity(i._creationQueue.pop());for(o=0;o<i._positionQueue.length;o++)c=i._positionQueue.pop(),c.o.position.call(c.o,c.val);i._canvas.width=i._canvas.width;for(e in i._entities)t=i._entities[e],t._draw(i._ctx,t.canvasPosition().x,t.canvasPosition().y);for(o=0;o<i._onRender.length;o++)i._onRender[o].fun.call(i._onRender[o].ctx,i._ctx);u.ClearForces(),u.DrawDebugData(),i._pause===!1?window.requestAnimationFrame(B):i._pause=B}(),i._ops.disableKeyEvents||(window.addEventListener("keydown",function(e){for(var t in i._keydownHandlers)i._entities[t]._destroyed||i._keydownHandlers[t].call(i._entities[t],e)},!1),window.addEventListener("keyup",function(e){for(var t in i._keyupHandlers)i._entities[t]._destroyed||i._keyupHandlers[t].call(i._entities[t],e)},!1));var h=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;N(e,t);for(var o in i._mousedownHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mousedownHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mousedownHandlers[o].call(i._entities[o],e,t)},d=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;k(e,t);for(var o in i._mouseupHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mouseupHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mouseupHandlers[o].call(i._entities[o],e,t)},m=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;C(e,t);for(var o in i._mousemoveHandlers)o===v?(s=i.find(n,r),t.entity=s.length>0?s[0]:null,i._mousemoveHandlers[o].call(i,e,t)):!i._entities[o]._destroyed&&i._entities[o].checkPosition(n,r)&&i._mousemoveHandlers[o].call(i._entities[o],e,t)},g=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;s=i.find(n,r),t.entity=s.length>0?s[0]:null,M(e,t),i._mouseinHandlers[v]&&i._mouseinHandlers[v].call(i,e,t)},y=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;s=i.find(n,r),t.entity=s.length>0?s[0]:null,_(e,t),i._mouseoutHandlers[v]&&i._mouseoutHandlers[v].call(i,e,t)},b=function(e){var t=i.calculateWorldPositionFromPointer(e),n=t.x,r=t.y,s;return s=i.find(n,r),t.entity=s.length>0?s[0]:null,t.touchIdentifier=e.identifier,t},w=function(e){var t=[],n;for(n=0;n<e.changedTouches.length;n++)e.changedTouches[n]&&t.push(b(e.changedTouches[n]));return t},E=function(e){var t=w(e);L(e,t),e.preventDefault()},S=function(e){var t=w(e);A(e,t),e.preventDefault()},x=function(e){var t=w(e);O(e,t),e.preventDefault()},T=function(e){i._touchcancelHandlers[v]&&i._touchcancelHandlers[v].call(i,e),e.preventDefault()},N=function(e,t){var n=t.x,r=t.y;if(i._draggingEntityId===null)for(var s in i._entities)!i._entities[s]._destroyed&&i._entities[s].checkPosition(n,r)&&i._entities[s]._ops._draggable.disabled===!1&&D.call(i._entities[s],e,t)},C=function(e,t){i._draggingEntityId!==null&&i._entities[i._draggingEntityId]._dragging&&D.call(i._entities[i._draggingEntityId],e,t);var n=i._hoverEntityId,r=null;for(var s in i._entities)!i._entities[s]._destroyed&&i._entities[s].checkPosition(t.x,t.y)&&(r=s);i._hoverEntityId=r,n===null&&r!==null&&i._mouseinHandlers[r]&&i._mouseinHandlers[r].call(i._entities[r],e,t),n!==null&&r===null&&i._mouseoutHandlers[n]&&i._mouseoutHandlers[n].call(i._entities[n],e,t)},k=function(e,t){i._draggingEntityId!==null&&i._entities[i._draggingEntityId]._dragging&&P.call(i._entities[i._draggingEntityId],e,t)},L=function(e,t){i._touchstartHandlers[v]&&i._touchstartHandlers[v].call(i,e,t)},A=function(e,t){i._touchmoveHandlers[v]&&i._touchmoveHandlers[v].call(i,e,t)},O=function(e,t){i._touchendHandlers[v]&&i._touchendHandlers[v].call(i,e,t)},M=function(e,t){t.entity&&i._mouseinHandlers[t.entity._id]&&i._mouseinHandlers[t.entity._id].call(i._entities[t.entity._id],e,t)},_=function(e,t){i._draggingEntityId!==null&&i._entities[i._draggingEntityId]._dragging&&P.call(i._entities[i._draggingEntityId],e,t),i._hoverEntityId!==null&&i._mouseoutHandlers[i._hoverEntityId]&&i._mouseoutHandlers[i._hoverEntityId].call(i._entities[i._hoverEntityId],e,t)},D=function(e,t){if(this._world._draggingEntityId===null&&!this._dragging&&!this._startDrag){this._dragging=t,this._startDrag=!0,this._world._draggingEntityId=this._id;if(this._ops._draggable.type==="regularDrag"){if(!this._moveJoint){var n=new Box2D.Dynamics.Joints.b2MouseJointDef;n.bodyA=this._world._world.GetGroundBody(),n.bodyB=this._body,n.target.Set(t.x,t.y),n.maxForce=1e28,n.timeStep=1/60,this._moveJoint=this._world._world.CreateJoint(n)}}else this._ops._draggable.type==="eventDrag"}else this._dragging&&(this._startDrag&&e.type==="mousemove"?(this._world._startdragHandlers[this._id]&&this._world._startdragHandlers[this._id].call(this,e,H(t,this._dragging)),this._startDrag=!1):this._world._dragHandlers[this._id]&&this._world._dragHandlers[this._id].call(this,e,H(t,this._dragging)));this._moveJoint&&this._moveJoint.SetTarget(new Box2D.Common.Math.b2Vec2(t.x,t.y))},P=function(e,t){this._dragging&&(this._moveJoint&&(this._world._world.DestroyJoint(this._moveJoint),this._moveJoint=null),this._startDrag===!1&&this._world._stopdragHandlers[this._id]&&this._world._stopdragHandlers[this._id].call(this,e,H(t,this._dragging))),this._startDrag=!1,this._dragging=!1,this._world._draggingEntityId=null},H=function(e,t){var n={};return n.position={},n.position.x=e.x,n.position.y=e.y,t&&(n.originalPosition={},n.originalPosition.x=t.x,n.originalPosition.y=t.y),n};i._ops.disableTouchEvents||(i._canvas.addEventListener("touchstart",E,!1),i._canvas.addEventListener("touchmove",S,!1),i._canvas.addEventListener("touchend",x,!1),i._canvas.addEventListener("touchcancel",T,!1)),i._ops.disableMouseEvents||(i._canvas.addEventListener("mousedown",h,!1),i._canvas.addEventListener("mouseup",d,!1),i._canvas.addEventListener("mousemove",m,!1),i._canvas.addEventListener("mouseover",g,!1),i._canvas.addEventListener("mouseout",y,!1)),i._ops.preventScroll&&document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1),a=new Box2D.Dynamics.b2ContactListener,a.BeginContact=function(e){var t=i._entities[e.GetFixtureA().GetBody()._bbid],n=i._entities[e.GetFixtureB().GetBody()._bbid];for(var r in i._startContactHandlers)t._id===Number(r)&&!t._destroyed&&i._startContactHandlers[r].call(i._entities[r],n),n._id===Number(r)&&!n._destroyed&&i._startContactHandlers[r].call(i._entities[r],t)},a.EndContact=function(e){var t=i._entities[e.GetFixtureA().GetBody()._bbid],n=i._entities[e.GetFixtureB().GetBody()._bbid];for(var r in i._finishContactHandlers)t._id===Number(r)&&!t._destroyed&&i._finishContactHandlers[r].call(i._entities[r],n),n._id===Number(r)&&!n._destroyed&&i._finishContactHandlers[r].call(i._entities[r],t)},a.PostSolve=function(e,t){var n=i._entities[e.GetFixtureA().GetBody()._bbid],r=i._entities[e.GetFixtureB().GetBody()._bbid];for(var s in i._impactHandlers)n._id===Number(s)&&!n._destroyed&&i._impactHandlers[s].call(i._entities[s],r,t.normalImpulses[0],t.tangentImpulses[0]),r._id===Number(s)&&!r._destroyed&&i._impactHandlers[s].call(i._entities[s],n,t.normalImpulses[0],t.tangentImpulses[0])},u.SetContactListener(a)}},checkListenersOptions:function(){var e=[];this._ops.disableTouchEvents&&this._ops.disableMouseEvents&&this._ops.disableKeyEvents&&("ontouchstart"in window&&(this._ops.disableTouchEvents=!1,e.push("touchEvents")),"mousedown"in window&&(this._ops.disableMouseEvents=!1,e.push("mouseEvents")),"onkeydown"in window&&(this._ops.disableKeyEvents=!1,e.push("keyEvents")),console.warn('All events were disabled in your config. The following available events on your device have been enabled : "'+e.join(", ")+'"'))},pause:function(){this._pause===!1?this._pause=!0:(window.requestAnimationFrame(this._pause),this._pause=!1)},_addKeydownHandler:function(e,t){this._keydownHandlers[e]=t},_addKeyupHandler:function(e,t){this._keyupHandlers[e]=t},_addMousedownHandler:function(e,t){this._mousedownHandlers[e]=t},_addMouseupHandler:function(e,t){this._mouseupHandlers[e]=t},_addMousemoveHandler:function(e,t){this._mousemoveHandlers[e]=t},_removeMousedownHandler:function(e){delete this._mousedownHandlers[e]},_removeMouseupHandler:function(e){delete this._mouseupHandlers[e]},_removeMousemoveHandler:function(e){delete this._mousemoveHandlers[e]},_addTouchstartHandler:function(e,t){this._touchstartHandlers[e]=t},_addTouchendHandler:function(e,t){this._touchendHandlers[e]=t},_addTouchmoveHandler:function(e,t){this._touchmoveHandlers[e]=t},_addTouchcancelHandler:function(e,t){this._touchcancelHandlers[e]=t},_removeTouchstartHandler:function(e){delete this._touchstartHandlers[e]},_removeTouchendHandler:function(e){delete this._touchendHandlers[e]},_removeTouchmoveHandler:function(e){delete this._touchmoveHandlers[e]},_removeTouchcancelHandler:function(e){delete this._touchHandlers[e]},_addStartdragHandler:function(e,t){this._startdragHandlers[e]=t},_addDragHandler:function(e,t){this._dragHandlers[e]=t},_addStopdragHandler:function(e,t){this._stopdragHandlers[e]=t},_addMouseinHandler:function(e,t){this._mouseinHandlers[e]=t},_addMouseoutHandler:function(e,t){this._mouseoutHandlers[e]=t},_removeMouseinHandler:function(e){delete this._mouseinHandlers[e]},_removeMouseoutHandler:function(e){delete this._mouseoutHandlers[e]},_removeStartdragHandler:function(e){delete this._startdragHandlers[e]},_removeDragHandler:function(e){delete this._dragHandlers[e]},_removeStopdragHandler:function(e){delete this._stopdragHandlers[e]},_addStartContactHandler:function(e,t){this._startContactHandlers[e]=t},_addFinishContactHandler:function(e,t){this._finishContactHandlers[e]=t},_addImpactHandler:function(e,t){this._impactHandlers[e]=t},_destroy:function(e){this._destroyQueue.push(e)},_applyImpulse:function(e,t,n,r){this._impulseQueue.push({id:e,body:t,x:n,y:r})},_setConstantVelocity:function(e,t,n,r,i){this._constantVelocities[e+t]={id:t,body:n,x:r,y:i}},_clearConstantVelocity:function(e,t){delete this._constantVelocities[e+t]},_setConstantForce:function(e,t,n,r,i){this._constantForces[e+t]={id:t,body:n,x:r,y:i}},_clearConstantForce:function(e,t){delete this._constantForces[e+t]},calculateWorldPositionFromPointer:function(e){return{x:(e.offsetX||e.layerX||e.pageX)/this.scale(),y:(e.offsetY||e.layerY||e.pageY)/this.scale()}},gravity:function(e){e!==undefined&&this._world.SetGravity(new r(0,e));var t=this._world.GetGravity();return{x:t.x,y:t.y}},createEntity:function(){var e={},r=Array.prototype.slice.call(arguments);r.reverse();for(var i in r)n(e,r[i]);if(this._world.IsLocked()){this._creationQueue.push(e);return}var s=t(y),o=this._nextEntityId++;return s._init(this,e,o),this._entities[o]=s,s},createJoint:function(e,t,r){r=r||{},r=n(r,d);var i=r.type,s;i==="distance"?s=new Box2D.Dynamics.Joints.b2DistanceJointDef:i==="revolute"?s=new Box2D.Dynamics.Joints.b2RevoluteJointDef:i==="gear"?s=new Box2D.Dynamics.Joints.b2GearJointDef:i==="friction"?s=new Box2D.Dynamics.Joints.b2FrictionJointDef:i==="prismatic"?s=new Box2D.Dynamics.Joints.b2PrismaticJointDef:i==="weld"?s=new Box2D.Dynamics.Joints.b2WeldJointDef:i==="pulley"?s=new Box2D.Dynamics.Joints.b2PulleyJointDef:i==="mouse"?s=new Box2D.Dynamics.Joints.b2MouseJointDef:i==="line"&&(s=new Box2D.Dynamics.Joints.b2LineJointDef),r.enableMotor&&(s.enableMotor=!0);var o=e._body.GetWorldCenter();r.jointPositionOnEntity1&&(o.x+=r.jointPositionOnEntity1.x,o.y+=r.jointPositionOnEntity1.y);var u=t._body.GetWorldCenter();r.jointPositionOnEntity2&&(u.x+=r.jointPositionOnEntity2.x,u.y+=r.jointPositionOnEntity2.y),i==="mouse"?(s.bodyA=e._body,s.bodyB=t._body):s.Initialize&&s.Initialize(e._body,t._body,o,u),r.allowCollisions&&(s.collideConnected=!0),this._world.CreateJoint(s)},find:function(e,t,n,r){n===undefined&&(n=e),r===undefined&&(r=t);var i=this,s=[],o=new h;return o.lowerBound.Set(e,t),o.upperBound.Set(n,r),this._world.QueryAABB(function(e){return s.push(i._entities[e.GetBody()._bbid]),!0},o),s},camera:function(e){e=e||{};if(e.x===undefined&&e.y===undefined)return{x:this._cameraX,y:this._cameraY};e.x!==undefined&&(this._cameraX=e.x),e.y!==undefined&&(this._cameraY=e.y)},onRender:function(e){this._onRender.push({fun:e,ctx:this})},unbindOnRender:function(e){var t=[],n;for(n=0;n<this._onRender.length;n++)this._onRender[n].fun!==e&&t.push(this._onRender[n]);this._onRender=t},onTick:function(e){this._onTick.push({fun:e,ctx:this})},unbindOnTick:function(e){var t=[],n;for(n=0;n<this._onTick.length;n++)this._onTick[n].fun!==e&&t.push(this._onTick[n]);this._onTick=t},scale:function(e){return e!==undefined&&(this._scale=e),this._scale},canvasPositionAt:function(e,t){var n=this.camera(),r=this.scale();return{x:Math.round((e+ -n.x)*r),y:Math.round((t+ -n.y)*r)}},onMousedown:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousedown"),!1;this._addMousedownHandler(v,e)},onMouseup:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseup"),!1;this._addMouseupHandler(v,e)},onMousemove:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousemove"),!1;this._addMousemoveHandler(v,e)},unbindOnMousedown:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousedown"),!1;this._removeMousedownHandler(v)},unbindOnMouseup:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseup"),!1;this._removeMouseupHandler(v)},unbindOnMousemove:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousemove"),!1;this._removeMousemoveHandler(v)},onMousein:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousein"),!1;this._addMouseinHandler(v,e)},onMouseout:function(e){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseout"),!1;this._addMouseoutHandler(v,e)},unbindOnMousein:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousein"),!1;this._removeMouseinHandler(v)},unbindOnMouseout:function(){if(this._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseout"),!1;this._removeMouseoutHandler(v)},onTouchstart:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchstart"),!1;this._addTouchstartHandler(v,e)},onTouchmove:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchmove"),!1;this._addTouchmoveHandler(v,e)},onTouchend:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchend"),!1;this._addTouchendHandler(v,e)},onTouchcancel:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchcancel"),!1;this._addTouchcancelHandler(v,e)},unbindOnTouchstart:function(){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchstart"),!1;this._removeTouchstartHandler(v)},unbindOnTouchmove:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchmove"),!1;this._removeTouchmoveHandler(v)},unbindOnTouchend:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchend"),!1;this._removeTouchendHandler(v)},unbindOnTouchcancel:function(e){if(this._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call unbindOnTouchcancel"),!1;this._removeTouchcancelHandler(v)}},g={name:"unnamed object",x:10,y:5,type:"dynamic",shape:"square",height:1,width:1,radius:1,points:[{x:0,y:0},{x:2,y:0},{x:0,y:2}],density:2,friction:1,restitution:.2,active:!0,rotation:null,fixedRotation:!1,bullet:!1,maxVelocityX:1e3,maxVelocityY:1e3,image:null,imageOffsetX:0,imageOffsetY:0,imageStretchToFit:null,color:"gray",borderColor:"black",borderWidth:1,spriteSheet:!1,spriteWidth:16,spriteHeight:16,spriteX:0,spriteY:0,init:null,draw:function(e,t,n){var r=-this._world._cameraX,s=-this._world._cameraY;e.fillStyle=this._ops.color,e.strokeStyle=this._ops.borderColor,e.lineWidth=this._ops.borderWidth;var o,u=this._world._scale,a=this._world._ops.collisionOutlines,f=this._ops.imageOffsetX||0,l=this._ops.imageOffsetY||0;f*=u,l*=u;if(this._sprite!==undefined){var c,h;this._ops.shape==="circle"&&this._ops.imageStretchToFit?(c=h=this._ops.radius*2,t-=this._ops.radius/2*u,n-=this._ops.radius/2*u):this._ops.imageStretchToFit?(c=this._ops.width,h=this._ops.height):this._ops.spriteSheet?(c=this._ops.spriteWidth/30,h=this._ops.spriteHeight/30):(c=this._sprite.width/30,h=this._sprite.height/30);var p=f+(t+c/4*u),d=l+(n+h/4*u);e.translate(p,d),e.rotate(this._body.GetAngle()),this._ops.spriteSheet?e.drawImage(this._sprite,this._ops.spriteX*this._ops.spriteWidth,this._ops.spriteY*this._ops.spriteHeight,this._ops.spriteWidth,this._ops.spriteHeight,-(c/2*u),-(h/2*u),c*u,h*u):e.drawImage(this._sprite,-(c/2*u),-(h/2*u),c*u,h*u),e.rotate(0-this._body.GetAngle()),e.translate(-p,-d)}if(this._sprite&&!a)return;a&&(this._sprite!==undefined&&(e.fillStyle="transparent"),e.strokeStyle="rgb(255, 0, 255)",e.lineWidth=2);if(this._ops.shape==="polygon"||this._ops.shape==="square"){var v=this._body.GetFixtureList().GetShape(),m=parseInt(v.GetVertexCount(),10),g=v.GetVertices(),y=new Vector(m),b=this._body.m_xf;for(o=0;o<m;++o)y[o]=i.MulX(b,g[o]);e.beginPath(),e.moveTo((r+y[0].x)*u,(s+y[0].y)*u);for(o=1;o<y.length;o++)e.lineTo((r+y[o].x)*u,(s+y[o].y)*u);e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}else if(this._ops.shape==="circle"){var w=this.position();e.beginPath(),e.arc((r+w.x)*u,(s+w.y)*u,this._ops.radius*u,0,Math.PI*2,!0),e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}}},y={_id:null,_ops:null,_body:null,_world:null,_init:function(t,r,i){var a,f;r&&r.components!==undefined&&(r.components.reverse(),r.components.forEach(function(e){n(r,e)})),this._ops=n(r,g),a=this._ops,this._body=new s;var c=this._body;this._world=t,this._id=i;for(f in this._ops)f.match(/^\$/)&&(this[f]=this._ops[f]);var h=new u;h.density=a.density,h.friction=a.friction,h.restitution=a.restitution,c.position.x=a.x,c.position.y=a.y,this._name=a.name,a.type==="static"?c.type=o.b2_staticBody:a.type==="dynamic"&&(c.type=o.b2_dynamicBody),a.shape==="square"?(h.shape=new l.b2PolygonShape,h.shape.SetAsBox(a.width/2,a.height/2)):a.shape==="circle"?h.shape=new l.b2CircleShape(a.radius):a.shape==="polygon"&&(h.shape=new l.b2PolygonShape,h.shape.SetAsArray(a.points,a.points.length)),a.rotation&&(c.angle=a.rotation/e),a.draw&&(this._draw=a.draw),a.image&&(this._sprite=new Image,this._sprite.src=a.image),a._draggable={disabled:!0,type:"regularDrag"},c.active=a.active,c.fixedRotation=a.fixedRotation,c.bullet=a.bullet,this._body=t._world.CreateBody(c),this._body.CreateFixture(h),this._body._bbid=i,a.onStartContact&&this._world._addStartContactHandler(i,a.onStartContact),a.onFinishContact&&this._world._addFinishContactHandler(i,a.onFinishContact),a.onImpact&&this._world._addImpactHandler(i,a.onImpact),a.onKeyDown&&this._world._addKeydownHandler(i,a.onKeyDown),a.onKeyUp&&this._world._addKeyupHandler(i,a.onKeyUp),a.onRender&&this.onRender(a.onRender),a.onTick&&this.onTick(a.onTick),a.init&&a.init.call(this)},_toVector:function(e,t,n){var r,i;return t=t||0,n===undefined?(t-=90,r=Math.cos(t*(Math.PI/180))*e,i=Math.sin(t*(Math.PI/180))*e):(r=t*e,i=n*e),{x:r,y:i}},name:function(e){return e!==undefined&&(this._name=e),this._name},position:function(e){e!==undefined&&(this._world._world.IsLocked()?this._world._positionQueue.push({o:this,val:e}):this._body.SetPosition(new r(e.x,e.y)));var t=this._body.GetPosition();return{x:t.x,y:t.y}},checkPosition:function(e,t){var n;if(this._body.GetType()!==o.b2_staticBody)this._world._world.QueryPoint(function(e){n=e.GetBody()},new r(e,t));else{var i=new h;i.lowerBound.Set(e-.001,t-.001),i.upperBound.Set(e-.001,t-.001),this._world._world.QueryAABB(function(e){n=e.GetBody()},i)}return n!==undefined&&this._id===n._bbid?!0:!1},canvasPosition:function(e){e!==undefined;var t=this.position();return this._world.canvasPositionAt(t.x,t.y)},rotation:function(t){return t!==undefined&&this._body.SetAngle(t/e),this._body.GetAngle()*e},friction:function(e){return e!==undefined&&this._body.GetFixtureList().SetFriction(e),this._body.GetFixtureList().GetFriction()},restitution:function(e){return e!==undefined&&this._body.GetFixtureList().SetRestitution(e),this._body.GetFixtureList().GetRestitution()},maxVelocityX:function(e){return e!==undefined&&(this._ops.maxVelocityX=e),this._ops.maxVelocityX},maxVelocityY:function(e){return e!==undefined&&(this._ops.maxVelocityY=e),this._ops.maxVelocityY},image:function(e){return e!==undefined&&(this._sprite=new Image,this._sprite.src=e),this._sprite.src},imageOffsetX:function(e){return e!==undefined&&(this._ops.imageOffsetX=e),this._ops.imageOffsetX},imageOffsetY:function(e){return e!==undefined&&(this._ops.imageOffsetY=e),this._ops.imageOffsetY},imageStretchToFit:function(e){return e!==undefined&&(this._ops.imageStretchToFit=e),this._ops.imageStretchToFit},color:function(e){return e!==undefined&&(this._ops.color=e),this._ops.color},borderColor:function(e){return e!==undefined&&(this._ops.borderColor=e),this._ops.borderColor},borderWidth:function(e){return e!==undefined&&(this._ops.borderWidth=e),this._ops.borderWidth},spriteSheet:function(e){return e!==undefined&&(this._ops.spriteSheet=e),this._ops.spriteSheet},spriteWidth:function(e){return e!==undefined&&(this._ops.spriteWidth=e),this._ops.spriteWidth},spriteHeight:function(e){return e!==undefined&&(this._ops.spriteHeight=e),this._ops.spriteHeight},draw:function(e){return e!==undefined&&(this._draw=e),this._draw},destroy:function(){this._destroyed=!0,this._world._destroy(this)},applyImpulse:function(e,t,n){var r=this._toVector(e,t,n);this._world._applyImpulse(this._id,this._body,r.x,r.y)},setForce:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantForce(e,this._id,this._body,i.x,i.y)},setVelocity:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantVelocity(e,this._id,this._body,i.x,i.y)},clearForce:function(e){this._world._clearConstantForce(e,this._id)},clearVelocity:function(e){this._world._clearConstantVelocity(e,this._id)},onKeydown:function(e){if(this._world._ops.disableKeyEvents)return console.warn("Key events are disabled, you tried to call onKeydown"),!1;this._world._addKeydownHandler(this._id,e)},onKeyup:function(e){if(this._world._ops.disableKeyEvents)return console.warn("Key events are disabled, you tried to call onKeyup"),!1;this._world._addKeyupHandler(this._id,e)},onMousedown:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousedown"),!1;this._world._addMousedownHandler(this._id,e)},onMouseup:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseup"),!1;this._world._addMouseupHandler(this._id,e)},onMousemove:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousemove"),!1;this._world._addMousemoveHandler(this._id,e)},unbindOnMousedown:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousedown"),!1;this._world._removeMousedownHandler(this._id)},unbindOnMouseup:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseup"),!1;this._world._removeMouseupHandler(this._id)},unbindOnMousemove:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousemove"),!1;this._world._removeMousemoveHandler(this._id)},onMousein:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMousein"),!1;this._ops.active===!1&&console.warn("onMousein only on active objects"),this._world._addMouseinHandler(this._id,e)},onMouseout:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call onMouseout"),!1;this._ops.active===!1&&console.warn("onMousein only on active objects"),this._world._addMouseoutHandler(this._id,e)},unbindOnMousein:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMousein"),!1;this._world._removeMouseinHandler(this._id)},unbindOnMouseout:function(){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call unbindOnMouseout"),!1;this._world._removeMouseoutHandler(this._id)},onTouchstart:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchstart"),!1;console.warn("Not implemented yet")},onTouchend:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchend"),!1;console.warn("Not implemented yet")},onTouchmove:function(e){if(this._world._ops.disableTouchEvents)return console.warn("Touch events are disabled, you tried to call onTouchmove"),!1;console.warn("Not implemented yet")},onStartContact:function(e){this._world._addStartContactHandler(this._id,e)},onFinishContact:function(e){this._world._addFinishContactHandler(this._id,e)},onImpact:function(e){this._world._addImpactHandler(this._id,e)},onRender:function(e){this._world._onRender.push({fun:e,ctx:this})},onTick:function(e){this._world._onTick.push({fun:e,ctx:this})},sprite:function(e,t){this._ops.spriteX=e,this._ops.spriteY=t},pin:function(e,t){this.isPined()&&this.unPin();var n=this.position(),i,s,o,u;e=e||n.x,t=t||n.y,u=this._body.GetLocalPoint(new r(e,t)),s=u.x,o=u.y,i=new Box2D.Dynamics.Joints.b2RevoluteJointDef,i.bodyA=this._world._world.GetGroundBody(),i.bodyB=this._body,i.target&&i.target.Set?i.target.Set(e,t):i.localAnchorA.Set(e,t),i.localAnchorB.Set(s,o),i.maxForce=1e28,i.timeStep=1/60,this._pinJoint=this._world._world.CreateJoint(i)},unPin:function(){this._pinJoint&&(this._world._world.DestroyJoint(this._pinJoint),this._pinJoint=null)},isPined:function(){return this._pinJoint?!0:!1},mouseDraggable:function(e){if(this._world._ops.disableMouseEvents)return console.warn("Mouse events are disabled, you tried to call mouseDraggable"),!1;if(typeof e=="undefined")this._ops._draggable.disabled=!1,this._ops._draggable.type="regularDrag";else if(typeof e=="string")switch(e){case"disable":this._ops._draggable.disabled=!0;break;case"enable":this._ops._draggable.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._draggable.disabled=e.disabled:this._ops._draggable.disabled=!1,typeof e.type=="string"&&(this._ops._draggable.type=e.type),typeof e.start=="function"?this._world._addStartdragHandler(this._id,e.start):typeof e.start!="undefined"&&this._world._removeStartdragHandler(this._id),typeof e.drag=="function"?this._world._addDragHandler(this._id,e.drag):typeof e.drag!="undefined"&&this._world._removeDragHandler(this._id),typeof e.stop=="function"?this._world._addStopdragHandler(this._id,e.stop):typeof e.stop!="undefined"&&this._world._removeStopdragHandler(this._id))}}}();